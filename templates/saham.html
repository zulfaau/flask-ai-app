<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prediksi Harga Saham</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #f5f7fb;
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      max-width: 750px;
      margin-top: 60px;
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 35px;
    }
    h2 {
      font-weight: 700;
      color: #2b4c7e;
      margin-bottom: 20px;
    }
    .btn-primary {
      background-color: #2b4c7e;
      border: none;
      border-radius: 10px;
      font-weight: 600;
    }
    .btn-primary:hover {
      background-color: #223c66;
    }
    #result-box {
      background-color: #eaf2ff;
      border-left: 6px solid #2b4c7e;
      padding: 15px 20px;
      border-radius: 10px;
      margin-top: 25px;
      display: none;
    }
    canvas {
      margin-top: 25px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h2>üìä Prediksi & Analisis Harga Saham</h2>
    <p class="text-muted mb-4">Masukkan simbol saham untuk memprediksi harga penutupan dan membandingkan hasilnya dengan data historis.</p>

    <form id="stockForm">
      <div class="mb-3">
        <label for="symbol">Simbol Saham:</label>
        <input type="text" class="form-control" id="symbol" placeholder="Contoh: BBCA" required>
      </div>

      <div class="mb-3">
        <label for="model">Pilih Varian Model:</label>
        <select id="model" class="form-select">
          <option value="LSTM">LSTM</option>
          <option value="GRU">GRU</option>
          <option value="Bidirectional LSTM">Bidirectional LSTM</option>
          <option value="Vanilla RNN">Vanilla RNN</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="days">Jumlah Hari Prediksi (1‚Äì30):</label>
        <input type="number" id="days" class="form-control" value="7" min="1" max="30" required>
      </div>

      <button type="submit" class="btn btn-primary w-100">üöÄ Jalankan Prediksi</button>
    </form>

    <div id="result-box" class="mt-4">
      <h5>üí° Hasil Prediksi</h5>
      <p><strong>Model:</strong> <span id="modelUsed"></span></p>
      <p><strong>Simbol:</strong> <span id="symbolUsed"></span></p>
      <p><strong>Periode Prediksi:</strong> <span id="daysUsed"></span> hari ke depan</p>
      <p class="fs-5 text-success" id="prediction"></p>

      <div class="mt-4">
        <h6>üìà Grafik Prediksi vs Aktual</h6>
        <canvas id="comparisonChart" height="130"></canvas>
      </div>

      <div class="mt-4">
        <h6>üìä Grafik Prediksi Saja</h6>
        <canvas id="stockChart" height="130"></canvas>
      </div>
    </div>

    <a href="/" class="btn btn-link mt-3">‚Üê Kembali ke Beranda</a>
  </div>

  <script>
    let chartPred = null;
    let chartComp = null;

    document.getElementById("stockForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      const symbol = document.getElementById("symbol").value.trim();
      const model = document.getElementById("model").value;
      const days = document.getElementById("days").value;

      const res = await fetch("/api/predict_stock", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ symbol, model, days })
      });

      const data = await res.json();
      if (data.ok) {
        document.getElementById("result-box").style.display = "block";
        document.getElementById("modelUsed").textContent = data.model || model;
        document.getElementById("symbolUsed").textContent = data.symbol || symbol;
        document.getElementById("daysUsed").textContent = data.days || days;
        document.getElementById("prediction").textContent = data.prediction || "Prediksi berhasil dihasilkan.";

        // === Simulasi Data (jika belum ada backend real) ===
        const labels = data.daysList || Array.from({length: days}, (_, i) => `Hari ke-${i+1}`);
        const predicted = data.predictions || Array.from({length: days}, (_, i) => (100 + i * 2 + Math.random() * 5).toFixed(2));
        const actual = data.actual || Array.from({length: days}, (_, i) => (100 + i * 2 + (Math.random() * 5 - 2)).toFixed(2));

        // === Grafik Prediksi Saja ===
        const ctx1 = document.getElementById("stockChart").getContext("2d");
        if (chartPred) chartPred.destroy();
        chartPred = new Chart(ctx1, {
          type: "line",
          data: {
            labels: labels,
            datasets: [{
              label: "Prediksi Harga (Rp)",
              data: predicted,
              borderColor: "#2b4c7e",
              backgroundColor: "rgba(43,76,126,0.1)",
              borderWidth: 2,
              tension: 0.3,
              pointRadius: 4,
              pointBackgroundColor: "#2b4c7e"
            }]
          }
        });

        // === Grafik Perbandingan (Aktual vs Prediksi) ===
        const ctx2 = document.getElementById("comparisonChart").getContext("2d");
        if (chartComp) chartComp.destroy();
        chartComp = new Chart(ctx2, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Harga Aktual (Rp)",
                data: actual,
                borderColor: "#ff6b6b",
                backgroundColor: "rgba(255,107,107,0.1)",
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 4,
                pointBackgroundColor: "#ff6b6b"
              },
              {
                label: "Prediksi (Rp)",
                data: predicted,
                borderColor: "#2b4c7e",
                backgroundColor: "rgba(43,76,126,0.1)",
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 4,
                pointBackgroundColor: "#2b4c7e"
              }
            ]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: false,
                title: { display: true, text: "Harga (Rp)" }
              },
              x: {
                title: { display: true, text: "Hari Prediksi" }
              }
            }
          }
        });

      } else {
        alert(data.error || "Terjadi kesalahan saat memproses prediksi.");
      }
    });
  </script>
</body>
</html>
